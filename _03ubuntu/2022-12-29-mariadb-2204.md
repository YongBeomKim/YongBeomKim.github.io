---
layout: blog
title: MariaDB on Ubuntu 22.04
tags:
- mariadb
---

`PostgreSQL` 에서 `16Gb` 데이터를 추출 후 압축을 진행해 보니 `1Gb` 로 줄어 들었습니다. 내용을 찾아보면 `PostgreSQL` 은 용량과 속도를 내주는 대신에, 활용성을 높인 데이터베이스로 간단한 반복작업을 하는 서비스 에서는 부적합 하다는 의견이 보였습니다. 대안으로 'MySQL', 'MariaDB' 를 활용하는 것이 속도와 용량등 모든 측면에서 유리하다는 의견들을 볼 수 있었습니다.

다음의 내용은 [How to Install and Set Up MariaDB on Ubuntu 22.04](https://www.makeuseof.com/install-set-up-mariadb-on-ubuntu/) 을 따라 진행한 내용을 정리해 보겠습니다.


<br />

# **설치하기**

## **데이터베이스 설치하기**

우분투 22.04 에서 부가적으로 필요한 모듈과, MariaDB 모듈을 설치하는 명령어는 다음과 같습니다. 

```r
sudo apt update && sudo apt upgrade
sudo apt-get install wget software-properties-common dirmngr ca-certificates apt-transport-https -y
sudo apt install mariadb-server mariadb-client
sudo pip install mycli
```

설치된 이후 상태를 확인하는 명령어는 다음과 같습니다.

```r
mariadb --version
sudo systemctl status mariadb
```

## **한글 및 포트 설정값 추가하기**
MariaDB 는 MySQL 과 동일한 [한글 깨짐현상](https://velog.io/@jmjmjames/Docker-MySQL-MariaDB-%ED%95%9C%EA%B8%80-%EA%B9%A8%EC%A7%90-%ED%98%84%EC%83%81-%EA%B4%80%EB%A0%A8-%EC%84%A4%EC%A0%95) 이 발생합니다. 아래의 예제내용 대로 변경을 하면 접속 Port 도 사용자가 바꿀 수 있습니다 <strike>Access IP 를 변경하여 외부에서도 접속 가능하도록 변경할 수 있습니다.</strike>

```r
# mysql encoding Setting
sudo nvim /etc/mysql/conf.d/mysql.cnf
  [mysql]
  default-character-set=utf8mb4
  [Client]
  default-character-set=utf8mb4
  [mysqld]
  character-set-server=utf8mb4
  collation-server=utf8mb4_unicode_ci
  skip-character-set-client-handshake
  [mysqldump]
  default-character-set=utf8mb4

# MariaDB Server Connection Setting
sudo nvim /etc/mysql/mariadb.conf.d/50-server.cnf
  # * Basic Settings
  port = 3306
  # Instead of skip-networking the default is now to listen only on
  # localhost which is more compatible and is not less secure.
  bind-address = 127.0.0.1
  # bind-address = 0.0.0.0
```

## Python: OSError: mariadb_config not found

파이썬 [mysqlclient](https://pypi.org/project/mysqlclient/) 모듈을 설치하다 보면 위의 오류가 발생하는 경우가 있습니다. [mariadb 패키지 요구사항](https://int-i.github.io/python/2021-03-01/mariadb-config-not-found/) 을 충족하지 못해서 발생하는 문제점으로 이를 해결하면 정상적인 진행이 가능합니다.

- C 컴파일러
- 파이썬 개발 패키지 (python-dev)
- MariaDB Connector/C 라이브러리 및 헤더 파일
- TLS 라이브러리 (ex. OpenSSL 등)

<br/>

# **User Password Setting**

## **Root 사용자 비밀번호 추가**

root 초기 사용자 암호를 추가해야 합니다. 작업이 원할하게 진행되지 않는다면 `mysql.user` 테이블의 plugin 컬럼에서 `unix_socket` 값을 `mysql_native_password` 로 [변경](https://oziguyo.tistory.com/36) 하면 됩니다.

```r
sudo mysql -u root

MariaDB [(none)]> use mysql;
MariaDB [mysql]> update user set password=password('비밀번호@@') where user='root';
MariaDB [mysql]> FLUSH PRIVILEGES;
MariaDB [mysql]> SELECT User, Host, plugin FROM mysql.user;

sudo mysql -u root -p
password:

sudo mycli -u root -h localhost mysql 
```

<br/>

## 참고사이트

- [ERROR mysql ERROR 1698 (28000): Access denied](https://velog.io/@yhe228/ERRORmysql-ERROR-1698-28000-Access-denied-for-user-rootlocalhost)
- [AWS MariaDB 원격접속 하기](https://conkjh032.tistory.com/28)
- [MariaDB 초기 접속암호 분실시](https://funfunit.tistory.com/104)
